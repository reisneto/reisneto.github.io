{"pageProps":{"post":{"title":"Using Circle CI to upload project to aws","date":"2020-08-11T06:50:00.322Z","slug":"using-circleci-to-upload-project-to-aws","author":{"name":"√Ålvaro Reis","picture":"/assets/blog/authors/alvaro.jpeg"},"content":"<p>This post is intended to help who already has some idea of these technologies and just need to adjust little things to make their projects works</p>\n<h2>What we want</h2>\n<p>The whole idea was  </p>\n<ul>\n<li>to build the project in a safe and computer-free environment </li>\n<li>guarantee code is tested and production ready</li>\n<li>send image to aws</li>\n<li>download image to run in a specific machine</li>\n</ul>\n<p>Docker helped with first part\n<put image of dockerfile here></p>\n<p>So far we have only lint test (for the sake of learning), but let's remember how crucial is to build tests.<br>\nTo automate lint test it was created a script called lint<br>\n<code>\"lint\": \"eslint --max-warnings 0 . &#x26;&#x26; echo 'Lint OK'\"</code><br>\nyou can find it <a href=\"https://github.com/reisneto/google-spreadsheet-api/blob/master/package.json#L6\">here</a>  </p>\n<h2>Script to run scripts inside docker container</h2>\n<p>Let's remember: we are coding using docker, so all tests must be done inside containers.<br>\nTo <code>make</code> my life easier I created a <a href=\"https://github.com/reisneto/google-spreadsheet-api/blob/master/makefile\">makefile</a> for that.  </p>\n<p>example of lint command<br>\n<code>docker-compose run --rm --no-deps app yarn lint</code>  </p>\n<ul>\n<li><code>run</code>: runs a container</li>\n<li><code>--rm</code>: remove container after it stops (so we don't end up our computer mememory space)</li>\n<li><code>--no-deps</code>: if we have a database linked for example (or another service) it doesn't run together</li>\n<li><code>app</code>: is the service name (as you can see <a href=\"https://github.com/reisneto/google-spreadsheet-api/blob/master/docker-compose.yml\">here</a></li>\n<li><code>yarn lint</code>: there it is, lint command running inside the container.  </li>\n</ul>\n<h2>Run Circle CI</h2>\n<p>To run it on circle ci I created a config.yml inside .circleci folder on the root of the project<br>\nhope <a href=\"https://github.com/reisneto/google-spreadsheet-api/blob/master/.circleci/config.yml\">this code</a> is self explanatory</p>\n<p>From <a href=\"https://github.com/reisneto/google-spreadsheet-api/blob/master/.circleci/config.yml#L36\">this line</a> at circle ci config file we describe:  </p>\n<ul>\n<li>dockerfile from wich the image is going to be made</li>\n<li>path: where dockerfile is found</li>\n<li>profile-name: what is the aws profiile</li>\n<li>repo: repository name from aws Elastic Container Registry</li>\n<li>tag: tag (remember to change it whenever your'e uploading a new image, otherwise the image on aws which has the same tag will lost it.)<br>\n<img src=\"/assets/blog/using-circleci-to-upload-project-to-aws/ecrImages.png\" alt=\"ECR images\"></li>\n</ul>\n<h3>AWS auth on Circle CI</h3>\n<p>Here I consider you know how to create a profile to upload images on ECR. You can check <a href=\"#links\">Link</a> section for help.\nWith a profile we need to set up some variables inside Circle CI</p>\n<p>So go to your project settings --> environment variables and put these ones:<br>\n<img src=\"/assets/blog/using-circleci-to-upload-project-to-aws/circleci-aws-variables.png\" alt=\"Circle CI - AWS variables\"></p>\n<p>Aaand maybe all will be fine:\n<img src=\"/assets/blog/using-circleci-to-upload-project-to-aws/circleci-running.png\" alt=\"Circle CI running\"></p>\n<h2>Links</h2>\n<ul>\n<li><a href=\"https://docs.aws.amazon.com/AmazonECR/latest/userguide/getting-started-cli.html\">Getting started with Amazon ECR using the AWS CLI</a></li>\n<li><a href=\"https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-quickstart.html\">AWS CLI - Configuration Basics</a></li>\n<li><a href=\"https://docs.aws.amazon.com/IAM/latest/UserGuide/introduction.html#intro-video\">What is IAM?</a></li>\n<li><a href=\"https://circleci.com/docs/2.0/ecs-ecr/\">Circle CI - Deploying to AWS ECR/ECS</a></li>\n<li><a href=\"https://circleci.com/integrations/aws/\">CircleCI and AWS</a></li>\n<li><a href=\"https://circleci.com/docs/2.0/env-vars/\">Using Environment Variables</a></li>\n</ul>\n<h2>The end</h2>\n<p>Any doubts you can reach me out at <a href=\"mailto:reisneto.alvaro@gmail.com\">reisneto.alvaro@gmail.com</a><br>\nsee ya!</p>\n","ogImage":{"url":"/assets/blog/using-circleci-to-upload-project-to-aws/cover.png"},"coverImage":"/assets/blog/using-circleci-to-upload-project-to-aws/cover.png"}},"__N_SSG":true}