<!DOCTYPE html><html lang="en"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"/><link rel="manifest" href="/favicon/site.webmanifest"/><link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#000000"/><link rel="shortcut icon" href="/favicon/favicon.ico"/><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-config" content="/favicon/browserconfig.xml"/><meta name="theme-color" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><meta name="description" content="A statically generated blog example using Next.js and Markdown."/><meta property="og:image" content="https://og-image.now.sh/Next.js%20Blog%20Starter%20Example.png?theme=light&amp;md=1&amp;fontSize=100px&amp;images=https%3A%2F%2Fassets.vercel.com%2Fimage%2Fupload%2Ffront%2Fassets%2Fdesign%2Fnextjs-black-logo.svg"/><title>Using Circle CI to upload project to aws | Next.js Blog Example with Markdown</title><meta property="og:image" content="/assets/blog/using-circleci-to-upload-project-to-aws/cover.png"/><meta name="next-head-count" content="16"/><link rel="preload" href="/_next/static/css/dee95cb3eb0acddbdbd1.css" as="style"/><link rel="stylesheet" href="/_next/static/css/dee95cb3eb0acddbdbd1.css"/><link rel="preload" href="/_next/static/css/b2509cdd2a8d2adb18f5.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b2509cdd2a8d2adb18f5.css"/><link rel="preload" href="/_next/static/chunks/main-f8cee52e05148884abcc.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-488dc228921f1fdbc0e7.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.d557686129d5a5cc0c94.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.c326fb833cc5579beb78.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-b190083eae221d2ced25.js" as="script"/><link rel="preload" href="/_next/static/chunks/2c3b9bffc7150b37a7b3810dfcf1c0b0fac2bd18.662fc5ba1a650b544028.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/posts/%5Bslug%5D-25b44dfb04e70336dbce.js" as="script"/></head><body><div id="__next"><div class="min-h-screen"><main><div class="container mx-auto px-5"><h2 class="text-2xl md:text-4xl font-bold tracking-tight md:tracking-tighter leading-tight mb-20 mt-8"><a class="hover:underline" href="/">Home</a></h2><article class="mb-32"><h1 class="text-6xl md:text-7xl lg:text-8xl font-bold tracking-tighter leading-tight md:leading-none mb-12 text-center md:text-left">Using Circle CI to upload project to aws</h1><div class="hidden md:block md:mb-12"><div class="flex items-center"><img src="/assets/blog/authors/alvaro.jpeg" class="w-12 h-12 rounded-full mr-4" alt="Álvaro Reis"/><div class="text-xl font-bold">Álvaro Reis</div></div></div><div class="mb-8 md:mb-16 -mx-5 sm:mx-0"><div class="-mx-5 sm:mx-0"><img src="/assets/blog/using-circleci-to-upload-project-to-aws/cover.png" alt="Cover Image for Using Circle CI to upload project to aws" class="shadow-small"/></div></div><div class="max-w-2xl mx-auto"><div class="block md:hidden mb-6"><div class="flex items-center"><img src="/assets/blog/authors/alvaro.jpeg" class="w-12 h-12 rounded-full mr-4" alt="Álvaro Reis"/><div class="text-xl font-bold">Álvaro Reis</div></div></div><div class="mb-6 text-lg"><time dateTime="2020-08-11T06:50:00.322Z">August	11, 2020</time></div></div><div class="max-w-2xl mx-auto"><div class="markdown-styles_markdown__1x9gM"><p>This post is intended to help who already has some idea of these technologies and just need to adjust little things to make their projects works</p>
<h2>What we want</h2>
<p>The whole idea was  </p>
<ul>
<li>to build the project in a safe and computer-free environment </li>
<li>guarantee code is tested and production ready</li>
<li>send image to aws</li>
<li>download image to run in a specific machine</li>
</ul>
<p>Docker helped with first part
<put image of dockerfile here></p>
<p>So far we have only lint test (for the sake of learning), but let's remember how crucial is to build tests.<br>
To automate lint test it was created a script called lint<br>
<code>"lint": "eslint --max-warnings 0 . &#x26;&#x26; echo 'Lint OK'"</code><br>
you can find it <a href="https://github.com/reisneto/google-spreadsheet-api/blob/master/package.json#L6">here</a>  </p>
<h2>Script to run scripts inside docker container</h2>
<p>Let's remember: we are coding using docker, so all tests must be done inside containers.<br>
To <code>make</code> my life easier I created a <a href="https://github.com/reisneto/google-spreadsheet-api/blob/master/makefile">makefile</a> for that.  </p>
<p>example of lint command<br>
<code>docker-compose run --rm --no-deps app yarn lint</code>  </p>
<ul>
<li><code>run</code>: runs a container</li>
<li><code>--rm</code>: remove container after it stops (so we don't end up our computer mememory space)</li>
<li><code>--no-deps</code>: if we have a database linked for example (or another service) it doesn't run together</li>
<li><code>app</code>: is the service name (as you can see <a href="https://github.com/reisneto/google-spreadsheet-api/blob/master/docker-compose.yml">here</a></li>
<li><code>yarn lint</code>: there it is, lint command running inside the container.  </li>
</ul>
<h2>Run Circle CI</h2>
<p>To run it on circle ci I created a config.yml inside .circleci folder on the root of the project<br>
hope <a href="https://github.com/reisneto/google-spreadsheet-api/blob/master/.circleci/config.yml">this code</a> is self explanatory</p>
<p>From <a href="https://github.com/reisneto/google-spreadsheet-api/blob/master/.circleci/config.yml#L36">this line</a> at circle ci config file we describe:  </p>
<ul>
<li>dockerfile from wich the image is going to be made</li>
<li>path: where dockerfile is found</li>
<li>profile-name: what is the aws profiile</li>
<li>repo: repository name from aws Elastic Container Registry</li>
<li>tag: tag (remember to change it whenever your'e uploading a new image, otherwise the image on aws which has the same tag will lost it.)<br>
<img src="/assets/blog/using-circleci-to-upload-project-to-aws/ecrImages.png" alt="ECR images"></li>
</ul>
<h3>AWS auth on Circle CI</h3>
<p>Here I consider you know how to create a profile to upload images on ECR. You can check <a href="#links">Link</a> section for help.
With a profile we need to set up some variables inside Circle CI</p>
<p>So go to your project settings --> environment variables and put these ones:<br>
<img src="/assets/blog/using-circleci-to-upload-project-to-aws/circleci-aws-variables.png" alt="Circle CI - AWS variables"></p>
<p>Aaand maybe all will be fine:
<img src="/assets/blog/using-circleci-to-upload-project-to-aws/circleci-running.png" alt="Circle CI running"></p>
<h2>Links</h2>
<ul>
<li><a href="https://docs.aws.amazon.com/AmazonECR/latest/userguide/getting-started-cli.html">Getting started with Amazon ECR using the AWS CLI</a></li>
<li><a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-quickstart.html">AWS CLI - Configuration Basics</a></li>
<li><a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/introduction.html#intro-video">What is IAM?</a></li>
<li><a href="https://circleci.com/docs/2.0/ecs-ecr/">Circle CI - Deploying to AWS ECR/ECS</a></li>
<li><a href="https://circleci.com/integrations/aws/">CircleCI and AWS</a></li>
<li><a href="https://circleci.com/docs/2.0/env-vars/">Using Environment Variables</a></li>
</ul>
<h2>The end</h2>
<p>Any doubts you can reach me out at <a href="mailto:reisneto.alvaro@gmail.com">reisneto.alvaro@gmail.com</a><br>
see ya!</p>
</div></div></article></div></main></div><footer class="bg-accent-1 border-t border-accent-2"><div class="container mx-auto px-5"><div class="py-28 flex flex-col lg:flex-row items-center"><h3 class="text-4xl lg:text-5xl font-bold tracking-tighter leading-tight text-center lg:text-left mb-10 lg:mb-0 lg:pr-4 lg:w-1/2">Sharing the path...</h3><div class="flex flex-col lg:flex-row justify-center items-center lg:pl-4 lg:w-1/2"><a href="https://github.com/reisneto" class="mx-3 font-bold hover:underline">GitHub</a></div></div></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"Using Circle CI to upload project to aws","date":"2020-08-11T06:50:00.322Z","slug":"using-circleci-to-upload-project-to-aws","author":{"name":"Álvaro Reis","picture":"/assets/blog/authors/alvaro.jpeg"},"content":"\u003cp\u003eThis post is intended to help who already has some idea of these technologies and just need to adjust little things to make their projects works\u003c/p\u003e\n\u003ch2\u003eWhat we want\u003c/h2\u003e\n\u003cp\u003eThe whole idea was  \u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eto build the project in a safe and computer-free environment \u003c/li\u003e\n\u003cli\u003eguarantee code is tested and production ready\u003c/li\u003e\n\u003cli\u003esend image to aws\u003c/li\u003e\n\u003cli\u003edownload image to run in a specific machine\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eDocker helped with first part\n\u003cput image of dockerfile here\u003e\u003c/p\u003e\n\u003cp\u003eSo far we have only lint test (for the sake of learning), but let's remember how crucial is to build tests.\u003cbr\u003e\nTo automate lint test it was created a script called lint\u003cbr\u003e\n\u003ccode\u003e\"lint\": \"eslint --max-warnings 0 . \u0026#x26;\u0026#x26; echo 'Lint OK'\"\u003c/code\u003e\u003cbr\u003e\nyou can find it \u003ca href=\"https://github.com/reisneto/google-spreadsheet-api/blob/master/package.json#L6\"\u003ehere\u003c/a\u003e  \u003c/p\u003e\n\u003ch2\u003eScript to run scripts inside docker container\u003c/h2\u003e\n\u003cp\u003eLet's remember: we are coding using docker, so all tests must be done inside containers.\u003cbr\u003e\nTo \u003ccode\u003emake\u003c/code\u003e my life easier I created a \u003ca href=\"https://github.com/reisneto/google-spreadsheet-api/blob/master/makefile\"\u003emakefile\u003c/a\u003e for that.  \u003c/p\u003e\n\u003cp\u003eexample of lint command\u003cbr\u003e\n\u003ccode\u003edocker-compose run --rm --no-deps app yarn lint\u003c/code\u003e  \u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003erun\u003c/code\u003e: runs a container\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e--rm\u003c/code\u003e: remove container after it stops (so we don't end up our computer mememory space)\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e--no-deps\u003c/code\u003e: if we have a database linked for example (or another service) it doesn't run together\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eapp\u003c/code\u003e: is the service name (as you can see \u003ca href=\"https://github.com/reisneto/google-spreadsheet-api/blob/master/docker-compose.yml\"\u003ehere\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eyarn lint\u003c/code\u003e: there it is, lint command running inside the container.  \u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003eRun Circle CI\u003c/h2\u003e\n\u003cp\u003eTo run it on circle ci I created a config.yml inside .circleci folder on the root of the project\u003cbr\u003e\nhope \u003ca href=\"https://github.com/reisneto/google-spreadsheet-api/blob/master/.circleci/config.yml\"\u003ethis code\u003c/a\u003e is self explanatory\u003c/p\u003e\n\u003cp\u003eFrom \u003ca href=\"https://github.com/reisneto/google-spreadsheet-api/blob/master/.circleci/config.yml#L36\"\u003ethis line\u003c/a\u003e at circle ci config file we describe:  \u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003edockerfile from wich the image is going to be made\u003c/li\u003e\n\u003cli\u003epath: where dockerfile is found\u003c/li\u003e\n\u003cli\u003eprofile-name: what is the aws profiile\u003c/li\u003e\n\u003cli\u003erepo: repository name from aws Elastic Container Registry\u003c/li\u003e\n\u003cli\u003etag: tag (remember to change it whenever your'e uploading a new image, otherwise the image on aws which has the same tag will lost it.)\u003cbr\u003e\n\u003cimg src=\"/assets/blog/using-circleci-to-upload-project-to-aws/ecrImages.png\" alt=\"ECR images\"\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3\u003eAWS auth on Circle CI\u003c/h3\u003e\n\u003cp\u003eHere I consider you know how to create a profile to upload images on ECR. You can check \u003ca href=\"#links\"\u003eLink\u003c/a\u003e section for help.\nWith a profile we need to set up some variables inside Circle CI\u003c/p\u003e\n\u003cp\u003eSo go to your project settings --\u003e environment variables and put these ones:\u003cbr\u003e\n\u003cimg src=\"/assets/blog/using-circleci-to-upload-project-to-aws/circleci-aws-variables.png\" alt=\"Circle CI - AWS variables\"\u003e\u003c/p\u003e\n\u003cp\u003eAaand maybe all will be fine:\n\u003cimg src=\"/assets/blog/using-circleci-to-upload-project-to-aws/circleci-running.png\" alt=\"Circle CI running\"\u003e\u003c/p\u003e\n\u003ch2\u003eLinks\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://docs.aws.amazon.com/AmazonECR/latest/userguide/getting-started-cli.html\"\u003eGetting started with Amazon ECR using the AWS CLI\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-quickstart.html\"\u003eAWS CLI - Configuration Basics\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://docs.aws.amazon.com/IAM/latest/UserGuide/introduction.html#intro-video\"\u003eWhat is IAM?\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://circleci.com/docs/2.0/ecs-ecr/\"\u003eCircle CI - Deploying to AWS ECR/ECS\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://circleci.com/integrations/aws/\"\u003eCircleCI and AWS\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://circleci.com/docs/2.0/env-vars/\"\u003eUsing Environment Variables\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003eThe end\u003c/h2\u003e\n\u003cp\u003eAny doubts you can reach me out at \u003ca href=\"mailto:reisneto.alvaro@gmail.com\"\u003ereisneto.alvaro@gmail.com\u003c/a\u003e\u003cbr\u003e\nsee ya!\u003c/p\u003e\n","ogImage":{"url":"/assets/blog/using-circleci-to-upload-project-to-aws/cover.png"},"coverImage":"/assets/blog/using-circleci-to-upload-project-to-aws/cover.png"}},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"using-circleci-to-upload-project-to-aws"},"buildId":"OMCCMrS6AEPD5zvk7GSD4","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-e0a799dda1546678fa28.js"></script><script src="/_next/static/chunks/main-f8cee52e05148884abcc.js" async=""></script><script src="/_next/static/chunks/webpack-488dc228921f1fdbc0e7.js" async=""></script><script src="/_next/static/chunks/framework.d557686129d5a5cc0c94.js" async=""></script><script src="/_next/static/chunks/commons.c326fb833cc5579beb78.js" async=""></script><script src="/_next/static/chunks/pages/_app-b190083eae221d2ced25.js" async=""></script><script src="/_next/static/chunks/2c3b9bffc7150b37a7b3810dfcf1c0b0fac2bd18.662fc5ba1a650b544028.js" async=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-25b44dfb04e70336dbce.js" async=""></script><script src="/_next/static/OMCCMrS6AEPD5zvk7GSD4/_buildManifest.js" async=""></script><script src="/_next/static/OMCCMrS6AEPD5zvk7GSD4/_ssgManifest.js" async=""></script></body></html>